<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ‰‹å†™æ•°å­—è¯†åˆ« Demoï¼ˆCNN + ONNX.jsï¼‰</title>
    <link href="/2026/01/20/%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB-Demo%EF%BC%88CNN-ONNX-js%EF%BC%89/"/>
    <url>/2026/01/20/%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB-Demo%EF%BC%88CNN-ONNX-js%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p>è¿™æ˜¯æˆ‘å®ç°çš„ä¸€ä¸ª <strong>æ‰‹å†™æ•°å­—è¯†åˆ« Demo</strong>ï¼š</p><ul><li>ä½¿ç”¨ <strong>è‡ªå·±è®­ç»ƒçš„æ‰‹å†™ CNN æ¨¡å‹çš„å‚æ•°</strong></li><li>é€šè¿‡ <strong>ONNX</strong> å¯¼å‡ºæ¨¡å‹</li><li>åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ <strong>onnxruntime-web</strong> è¿›è¡Œæ¨ç†</li><li>æ”¯æŒåœ¨ç½‘é¡µä¸Šç›´æ¥æ‰‹å†™æ•°å­—å¹¶å®æ—¶é¢„æµ‹ç»“æœ</li></ul><hr><h2 id="åœ¨çº¿ä½“éªŒ"><a href="#åœ¨çº¿ä½“éªŒ" class="headerlink" title="åœ¨çº¿ä½“éªŒ"></a>åœ¨çº¿ä½“éªŒ</h2><p>ğŸ‘‰ <strong>ç‚¹å‡»è¿™é‡Œä½“éªŒ Demoï¼š</strong></p><a href="/mnist_page/index.html" target="_blank">æ‰‹å†™æ•°å­—è¯†åˆ« Demoï¼ˆåŸºç¡€ç‰ˆï¼‰</a><br><a href="/mnist_page_comp/index.html" target="_blank">æ‰‹å†™æ•°å­—è¯†åˆ« Demoï¼ˆå¯¹æ¯”ç‰ˆï¼‰</a><hr><h2 id="æŠ€æœ¯ç»†èŠ‚"><a href="#æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="æŠ€æœ¯ç»†èŠ‚"></a>æŠ€æœ¯ç»†èŠ‚</h2><ul><li>è¾“å…¥ï¼šCanvas æ‰‹å†™æ•°å­—ï¼ˆ28Ã—28 ç°åº¦ï¼‰</li><li>æ¨¡å‹ï¼šCNNï¼ˆPyTorch â†’ ONNXï¼‰</li><li>æ¨ç†ï¼šonnxruntime-webï¼ˆçº¯å‰ç«¯ï¼Œæ— åç«¯ï¼‰</li><li>éƒ¨ç½²ï¼šGitHub Pages + Hexo</li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®å±•ç¤º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ·±åº¦å­¦ä¹ </tag>
      
      <tag>CNN</tag>
      
      <tag>ONNX</tag>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäº ONNX çš„æµè§ˆå™¨ç«¯æ‰‹å†™æ•°å­—è¯†åˆ«æ¨ç†</title>
    <link href="/2026/01/20/%E5%9F%BA%E4%BA%8E%20ONNX%20%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB%E6%8E%A8%E7%90%86/"/>
    <url>/2026/01/20/%E5%9F%BA%E4%BA%8E%20ONNX%20%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB%E6%8E%A8%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æ ‡å‡†ç½‘é¡µåŒ…å«å“ªäº›æ–‡ä»¶ï¼Ÿ"><a href="#1-æ ‡å‡†ç½‘é¡µåŒ…å«å“ªäº›æ–‡ä»¶ï¼Ÿ" class="headerlink" title="1. æ ‡å‡†ç½‘é¡µåŒ…å«å“ªäº›æ–‡ä»¶ï¼Ÿ"></a>1. æ ‡å‡†ç½‘é¡µåŒ…å«å“ªäº›æ–‡ä»¶ï¼Ÿ</h2><p>ä¸€ä¸ªæ ‡å‡†çš„ç½‘é¡µåŒ…å«</p><ul><li><code>index.html</code> â† ç»“æ„ï¼ˆHTMLï¼‰</li><li><code>style.css</code>  â† æ ·å¼ï¼ˆCSSï¼‰</li><li><code>script.js</code>  â† é€»è¾‘ï¼ˆJavaScriptï¼‰</li></ul><h2 id="2-åªæœ‰å‰ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#2-åªæœ‰å‰ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. åªæœ‰å‰ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>2. åªæœ‰å‰ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><p><strong>åªæœ‰å‰ç«¯ï¼šé¡µé¢èƒ½è·‘ï¼Œä½†â€œä¸ä¼šç®—â€â€”â€”åªèƒ½å±•ç¤ºã€äº¤äº’ã€åšéå¸¸è½»çš„é€»è¾‘</strong></p><ul><li>ä¸èƒ½åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹  </li><li>ä¸èƒ½å¤ç”¨ä½ è®­ç»ƒå¥½çš„æƒé‡  </li><li>æ¨ç†åªèƒ½é æ‰‹å†™ js ç®—</li></ul><h2 id="3-å‰åç«¯ååŒ-vs-å‰ç«¯-ONNX"><a href="#3-å‰åç«¯ååŒ-vs-å‰ç«¯-ONNX" class="headerlink" title="3. å‰åç«¯ååŒ vs å‰ç«¯ + ONNX"></a>3. å‰åç«¯ååŒ vs å‰ç«¯ + ONNX</h2><p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œå‰ç«¯ä¸åç«¯ååŒçš„æ¶æ„æ›´é€‚åˆæ„å»ºå®Œæ•´ã€å¯æ‰©å±•çš„ Web ç³»ç»Ÿï¼Œæ¨¡å‹æ¨ç†é€šå¸¸ç”±åç«¯ç»Ÿä¸€å®Œæˆï¼Œä»¥ä¿è¯æ€§èƒ½ã€å¯æ§æ€§å’Œæ¨¡å‹å®‰å…¨ã€‚<br>è€Œåœ¨æ•™å­¦æ¼”ç¤ºæˆ–è½»é‡æ¨¡å‹åœºæ™¯ä¸‹ï¼Œé‡‡ç”¨å‰ç«¯ç»“åˆ ONNX è¿›è¡Œæµè§ˆå™¨ç«¯æ¨ç†ï¼Œå¯ä»¥æ˜¾è‘—é™ä½ç³»ç»Ÿå¤æ‚åº¦ï¼Œæå‡éƒ¨ç½²å’Œç†è§£çš„ä¾¿åˆ©æ€§ã€‚</p><h2 id="4-ONNX-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-ONNX-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. ONNX æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4. ONNX æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ONNX çš„ å…¨ç§°æ˜¯ Open Neural Network Exchangeï¼Œç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯å¼€æ”¾ç¥ç»ç½‘ç»œäº¤æ¢æ ¼å¼ã€‚</p><p>ONNX æ˜¯â€œæ¨¡å‹çš„é€šç”¨è¯­è¨€ &#x2F; ä¸­é—´æ ¼å¼â€ï¼Œè®©ä¸åŒæ¡†æ¶è®­ç»ƒçš„æ¨¡å‹å¯ä»¥åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œã€‚</p><p>.onnx &#x3D; ç¥ç»ç½‘ç»œçš„â€œè¯´æ˜ä¹¦ + å‚æ•°â€</p><p>é‡Œé¢ä¿å­˜äº†ï¼š</p><ul><li>ç½‘ç»œç»“æ„<ul><li>ç”¨äº†å“ªäº›å±‚ï¼ˆå·ç§¯ã€æ± åŒ–ã€å…¨è¿æ¥ã€æ¿€æ´»å‡½æ•°ç­‰ï¼‰</li><li>æ¯ä¸€å±‚çš„é…ç½®å‚æ•°</li><li>ç»“æ„å›¾</li></ul></li><li>æƒé‡å‚æ•°ï¼ˆWã€bï¼‰</li><li>è®¡ç®—å›¾</li></ul><p>ç½‘ç»œç»“æ„ä¸­çš„ç»“æ„å›¾æè¿°æ¨¡å‹çš„å±‚çº§ç»„ç»‡å½¢å¼ï¼Œè®¡ç®—å›¾æè¿°æ¨¡å‹åœ¨ä¸€æ¬¡å‰å‘ä¸åå‘ä¼ æ’­ä¸­æ‰€æœ‰ç®—å­ä¹‹é—´çš„ç²¾ç¡®è®¡ç®—ä¾èµ–å…³ç³»ï¼Œè®¡ç®—å›¾æŠŠç»“æ„å›¾ä¸­çš„ç»†èŠ‚å±•å¼€ã€‚</p><h2 id="5-å°†æ‰‹å†™-CNN-è½¬æˆ-ONNX-æ¨¡å‹ï¼šå…³é”®é—®é¢˜"><a href="#5-å°†æ‰‹å†™-CNN-è½¬æˆ-ONNX-æ¨¡å‹ï¼šå…³é”®é—®é¢˜" class="headerlink" title="5. å°†æ‰‹å†™ CNN è½¬æˆ ONNX æ¨¡å‹ï¼šå…³é”®é—®é¢˜"></a>5. å°†æ‰‹å†™ CNN è½¬æˆ ONNX æ¨¡å‹ï¼šå…³é”®é—®é¢˜</h2><h3 id="5-1-ONNX-ä¸ºä»€ä¹ˆæ— æ³•è¯†åˆ«æ‰‹å†™-CNNï¼Ÿ"><a href="#5-1-ONNX-ä¸ºä»€ä¹ˆæ— æ³•è¯†åˆ«æ‰‹å†™-CNNï¼Ÿ" class="headerlink" title="5.1 ONNX ä¸ºä»€ä¹ˆæ— æ³•è¯†åˆ«æ‰‹å†™ CNNï¼Ÿ"></a>5.1 ONNX ä¸ºä»€ä¹ˆæ— æ³•è¯†åˆ«æ‰‹å†™ CNNï¼Ÿ</h3><p>ONNX çš„æ ¸å¿ƒæ˜¯åŸºäºæ ‡å‡†çš„ç®—å­åº“æ¥æ„å»ºè®¡ç®—å›¾ï¼Œæ‰‹å†™çš„CNNç®—å­ä¸åœ¨è¿™ä¸ªåº“ä¸­ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥è½¬æˆONNXæ¨¡å‹ã€‚å› æ­¤éœ€è¦æŠŠæ‰‹å†™çš„CNNè½¬æ¢æˆè‡ªå·±ç†Ÿæ‚‰çš„æ¡†æ¶ï¼ˆå¦‚PyTorchï¼‰ï¼Œå†å¯¼å‡ºä¸ºONNXæ ¼å¼ï¼Œä½†æ˜¯æ‰‹å†™çš„CNNæ¨¡å‹è®­ç»ƒå‡ºæ¥çš„çš„å‚æ•°è¿˜æ˜¯å¯ä»¥ç”¨çš„ã€‚</p><h3 id="5-2-PyTorch-æ€ä¹ˆå¯¼å‡º-ONNXï¼Ÿ"><a href="#5-2-PyTorch-æ€ä¹ˆå¯¼å‡º-ONNXï¼Ÿ" class="headerlink" title="5.2 PyTorch æ€ä¹ˆå¯¼å‡º ONNXï¼Ÿ"></a>5.2 PyTorch æ€ä¹ˆå¯¼å‡º ONNXï¼Ÿ</h3><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><code>torch.onnx.export(model, dummy_input, onnx_path, verbose=True)</code></p><ul><li><code>model</code> æ˜¯ pytorch æ¨¡å‹  </li><li><code>dummy_input</code> æ˜¯ä¸€ä¸ªè¾“å…¥æ ·æœ¬  </li><li><code>onnx_path</code> æ˜¯è¾“å‡ºçš„ onnx æ¨¡å‹è·¯å¾„</li><li><code>verbose</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦æ‰“å°è¯¦ç»†çš„è½¬æ¢ä¿¡æ¯ã€‚</li></ul><p>åœ¨ç¨‹åºé‡Œä¸€å®šè¦æŠŠæ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼å†è½¬æ¢ï¼š<code>model.eval()</code></p><h3 id="5-3-ä¸ºä»€ä¹ˆ-ONNX-js-è·‘ä¸äº†ï¼Œä½†-onnxruntime-web-å¯ä»¥ï¼Ÿ"><a href="#5-3-ä¸ºä»€ä¹ˆ-ONNX-js-è·‘ä¸äº†ï¼Œä½†-onnxruntime-web-å¯ä»¥ï¼Ÿ" class="headerlink" title="5.3 ä¸ºä»€ä¹ˆ ONNX.js è·‘ä¸äº†ï¼Œä½† onnxruntime-web å¯ä»¥ï¼Ÿ"></a>5.3 ä¸ºä»€ä¹ˆ ONNX.js è·‘ä¸äº†ï¼Œä½† onnxruntime-web å¯ä»¥ï¼Ÿ</h3><p>ONNX.js æ— æ³•ç›´æ¥åŠ è½½ PyTorch å¯¼å‡ºçš„ ONNX æ¨¡å‹ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæ¨¡å‹ä½¿ç”¨äº†éæ ‡å‡†ç®—å­ï¼Œè€Œæ˜¯å› ä¸º ONNX.js å¯¹ ONNX æ ‡å‡†ç®—å­çš„æ”¯æŒéå¸¸æœ‰é™ï¼Œä¸”é¡¹ç›®å·²åœæ­¢ç»´æŠ¤ã€‚<br>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒONNX Runtime Web æä¾›äº†åŸºäº WASM &#x2F; WebGPU çš„å®Œæ•´æ¨ç†åç«¯ï¼Œèƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œç”± PyTorch å¯¼å‡ºçš„ ONNX è®¡ç®—å›¾ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å…¼å®¹ PyTorch æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯é‚£äº›åŒ…å«å¤æ‚è®¡ç®—çš„æ“ä½œï¼Œå› æ­¤åœ¨å®é™…å·¥ç¨‹ä¸­åº”ä¼˜å…ˆä½¿ç”¨ onnxruntime-webã€‚</p><h3 id="5-4-ç½‘é¡µè¾“å…¥æ ¼å¼ä¸æ¨¡å‹è¾“å…¥ä¸ä¸€è‡´"><a href="#5-4-ç½‘é¡µè¾“å…¥æ ¼å¼ä¸æ¨¡å‹è¾“å…¥ä¸ä¸€è‡´" class="headerlink" title="5.4 ç½‘é¡µè¾“å…¥æ ¼å¼ä¸æ¨¡å‹è¾“å…¥ä¸ä¸€è‡´"></a>5.4 ç½‘é¡µè¾“å…¥æ ¼å¼ä¸æ¨¡å‹è¾“å…¥ä¸ä¸€è‡´</h3><p>ç½‘é¡µé‡Œé¢ç”»å‡ºæ¥çš„æ•°å­—ä¸æ¨¡å‹éœ€è¦çš„è¾“å…¥æ ¼å¼ä¸åŒï¼Œç½‘é¡µé‡Œé¢ç”»çš„æ•°å­—æ˜¯280x280çš„RGBAå›¾åƒï¼Œè€Œæ¨¡å‹éœ€è¦çš„è¾“å…¥æ˜¯1Ã—1x28x28çš„å¼ é‡ã€‚<br>ä¸¤ç§æ–¹æ³•è½¬æ¢ï¼š<br>1.æ˜¯åœ¨å‰ç«¯ç›´æ¥å¤„ç†<br>2.æ˜¯åœ¨åç«¯å¤„ç†ï¼Œå°†å›¾åƒç»´åº¦è°ƒæˆ(1, 1, 28, 28)ã€‚</p><p>åœ¨æ•™å­¦æ¼”ç¤ºå’Œè½»é‡æ¨¡å‹åœºæ™¯ä¸‹ï¼Œå°†è¾“å…¥é¢„å¤„ç†æ”¾åœ¨å‰ç«¯å®ç°ï¼Œå¯ä»¥æ˜¾è‘—é™ä½ç³»ç»Ÿå¤æ‚åº¦ï¼Œä¾¿äºç†è§£æ¨¡å‹è¾“å…¥ä¸æ¨ç†æµç¨‹ï¼›<br>è€Œåœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå°†å›¾åƒé¢„å¤„ç†ä¸æ¨¡å‹æ¨ç†ç»Ÿä¸€æ”¾åœ¨åç«¯ï¼Œä»¥ä¿è¯ä¸è®­ç»ƒé˜¶æ®µé¢„å¤„ç†çš„ä¸€è‡´æ€§ï¼Œå¹¶æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ä¸å®‰å…¨æ€§ã€‚</p><h3 id="5-5-æ¨¡å‹è¾“å‡ºçš„æ˜¯logitsè¿˜æ˜¯æ¦‚ç‡"><a href="#5-5-æ¨¡å‹è¾“å‡ºçš„æ˜¯logitsè¿˜æ˜¯æ¦‚ç‡" class="headerlink" title="5.5 æ¨¡å‹è¾“å‡ºçš„æ˜¯logitsè¿˜æ˜¯æ¦‚ç‡"></a>5.5 æ¨¡å‹è¾“å‡ºçš„æ˜¯logitsè¿˜æ˜¯æ¦‚ç‡</h3><p>å¯¹äºpytorchå†™çš„CNNæ¨¡å‹ä¸€èˆ¬å’Œäº¤å‰ç†µå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å‹è¾“å‡ºçš„æ˜¯çº¿æ€§å±‚çš„åŸå§‹è¾“å‡ºï¼Œç”¨softmaxè½¬æ¢æˆæ¦‚ç‡è¿™ä¸€æ­¥åœ¨äº¤å‰ç†µå‡½æ•°é‡Œé¢ï¼Œå› æ­¤éœ€è¦åœ¨jsæ–‡ä»¶é‡Œé¢å°†æ¨¡å‹è¾“å‡ºç”¨softmaxè½¬æ¢æˆçœŸæ­£çš„æ¦‚ç‡åœ¨è¿›è¡Œé¡µé¢å±•ç¤ºã€‚å¦‚æœæ¨¡å‹è¾“å‡ºçš„æ˜¯logitsï¼Œéœ€è¦åœ¨å‰ç«¯å¯¹logitsè¿›è¡Œsoftmaxå¤„ç†ï¼Œå¾—åˆ°æ¦‚ç‡åˆ†å¸ƒã€‚å¦‚æœæ¨¡å‹è¾“å‡ºçš„æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><h2 id="6-æˆ‘çš„å¯¼å‡ºä»£ç "><a href="#6-æˆ‘çš„å¯¼å‡ºä»£ç " class="headerlink" title="6. æˆ‘çš„å¯¼å‡ºä»£ç "></a>6. æˆ‘çš„å¯¼å‡ºä»£ç </h2><details><summary><b>ç‚¹å‡»å±•å¼€ï¼šPyTorch è½½å…¥æ‰‹å†™ CNN å‚æ•°å¹¶å¯¼å‡º ONNX</b></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><span class="hljs-keyword">import</span> os<br><br>BASE_DIR = os.path.dirname(os.path.abspath(__file__))<br>onnx_path = os.path.join(BASE_DIR, <span class="hljs-string">&quot;cnn.onnx&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CNN_Torch</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, state</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-comment"># å·ç§¯å±‚å‚æ•°</span><br>        <span class="hljs-variable language_">self</span>.W1 = nn.Parameter(torch.from_numpy(state[<span class="hljs-string">&quot;conv_K1&quot;</span>]).<span class="hljs-built_in">float</span>())<br>        <span class="hljs-variable language_">self</span>.B1 = nn.Parameter(torch.from_numpy(state[<span class="hljs-string">&quot;conv_B1&quot;</span>]).<span class="hljs-built_in">float</span>())<br>        <span class="hljs-variable language_">self</span>.W2 = nn.Parameter(torch.from_numpy(state[<span class="hljs-string">&quot;conv_K2&quot;</span>]).<span class="hljs-built_in">float</span>())<br>        <span class="hljs-variable language_">self</span>.B2 = nn.Parameter(torch.from_numpy(state[<span class="hljs-string">&quot;conv_B2&quot;</span>]).<span class="hljs-built_in">float</span>())<br><br>        <span class="hljs-variable language_">self</span>.fc1 = nn.Linear(<span class="hljs-number">216</span>, <span class="hljs-number">64</span>)<br>        <span class="hljs-variable language_">self</span>.fc2 = nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)<br><br>        <span class="hljs-comment"># çº¿æ€§å±‚å‚æ•°</span><br>        <span class="hljs-variable language_">self</span>.fc1.weight.data = torch.from_numpy(state[<span class="hljs-string">&quot;nn_W1&quot;</span>]).<span class="hljs-built_in">float</span>()<br>        <span class="hljs-variable language_">self</span>.fc1.bias.data = torch.from_numpy(state[<span class="hljs-string">&quot;nn_b1&quot;</span>]).<span class="hljs-built_in">float</span>().squeeze()<br>        <span class="hljs-variable language_">self</span>.fc2.weight.data = torch.from_numpy(state[<span class="hljs-string">&quot;nn_W2&quot;</span>]).<span class="hljs-built_in">float</span>()<br>        <span class="hljs-variable language_">self</span>.fc2.bias.data = torch.from_numpy(state[<span class="hljs-string">&quot;nn_b2&quot;</span>]).<span class="hljs-built_in">float</span>().squeeze()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># x: (N,1,28,28)</span><br>        y = F.conv2d(x, <span class="hljs-variable language_">self</span>.W1, bias=<span class="hljs-variable language_">self</span>.B1, stride=<span class="hljs-number">1</span>)<br>        y = F.max_pool2d(y, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)             <span class="hljs-comment"># (N,3,13,13)</span><br><br>        y = F.conv2d(y, <span class="hljs-variable language_">self</span>.W2, bias=<span class="hljs-variable language_">self</span>.B2, stride=<span class="hljs-number">1</span>)<br>        y = F.max_pool2d(y, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)             <span class="hljs-comment"># (N,6,6,6)</span><br><br>        y = y.view(y.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)             <span class="hljs-comment"># (N,216)</span><br>        y = F.leaky_relu(<span class="hljs-variable language_">self</span>.fc1(y), negative_slope=<span class="hljs-number">0.05</span>)<br>        y = F.softmax(<span class="hljs-variable language_">self</span>.fc2(y), dim=<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> y<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># ä½ æ‰‹å†™æ¨¡å‹ä¿å­˜çš„ npz</span><br>    state_path = os.path.join(BASE_DIR, <span class="hljs-string">&quot;cnn_mnist_10.npz&quot;</span>)<br>    state = np.load(state_path)<br>    model = CNN_Torch(state)<br>    model.<span class="hljs-built_in">eval</span>()<br><br>    dummy_input = torch.zeros(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)<br>    torch.onnx.export(model, dummy_input, onnx_path, verbose=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><summary><b>ç‚¹å‡»å±•å¼€ï¼šPyTorch è½½å…¥æ‰‹å†™ CNN å‚æ•°å¹¶å¯¼å‡º ONNX</b></summary><details><summary><b>ç‚¹å‡»å±•å¼€ï¼šçº¯PyTorch å¯¼å‡º ONNX</b></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># æ–‡ä»¶è·¯å¾„</span><br>BASE_DIR = os.path.dirname(os.path.abspath(__file__))<br>pth_path = os.path.join(BASE_DIR, <span class="hljs-string">&quot;cnn_mnist_60000.pth&quot;</span>)<br>onnx_path = os.path.join(BASE_DIR, <span class="hljs-string">&quot;cnn_mnist_60000.onnx&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleCNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">10</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-variable language_">self</span>.conv1 = nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.pool1 = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br><br>        <span class="hljs-variable language_">self</span>.conv2 = nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.pool2 = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br><br>        <span class="hljs-variable language_">self</span>.flatten = nn.Flatten()<br>        <span class="hljs-variable language_">self</span>.fc1 = nn.Linear(<span class="hljs-number">32</span> * <span class="hljs-number">7</span> * <span class="hljs-number">7</span>, <span class="hljs-number">128</span>)<br>        <span class="hljs-variable language_">self</span>.fc2 = nn.Linear(<span class="hljs-number">128</span>, num_classes)<br><br>        <span class="hljs-variable language_">self</span>.act = nn.ReLU()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = <span class="hljs-variable language_">self</span>.act(<span class="hljs-variable language_">self</span>.conv1(x))<br>        x = <span class="hljs-variable language_">self</span>.pool1(x)<br>        x = <span class="hljs-variable language_">self</span>.act(<span class="hljs-variable language_">self</span>.conv2(x))<br>        x = <span class="hljs-variable language_">self</span>.pool2(x)<br>        x = <span class="hljs-variable language_">self</span>.flatten(x)<br>        x = <span class="hljs-variable language_">self</span>.act(<span class="hljs-variable language_">self</span>.fc1(x))<br>        x = <span class="hljs-variable language_">self</span>.fc2(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># 1ï¸ å»ºç«‹æ¨¡å‹ç»“æ„</span><br>    model = SimpleCNN()<br><br>    <span class="hljs-comment"># 2ï¸ åŠ è½½ PyTorch è®­ç»ƒå¥½çš„å‚æ•°</span><br>    state_dict = torch.load(pth_path, map_location=<span class="hljs-string">&quot;cpu&quot;</span>)<br>    model.load_state_dict(state_dict)<br><br>    model.<span class="hljs-built_in">eval</span>()<br><br>    <span class="hljs-comment"># 3ï¸ dummy inputï¼ˆä¸€å®šè¦å’ŒçœŸå®è¾“å…¥å½¢çŠ¶ä¸€è‡´ï¼‰</span><br>    dummy_input = torch.zeros(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)<br><br>    <span class="hljs-comment"># 4ï¸ å¯¼å‡º ONNX</span><br>    torch.onnx.export(<br>        model,<br>        dummy_input,<br>        onnx_path,<br>        input_names=[<span class="hljs-string">&quot;input&quot;</span>],<br>        output_names=[<span class="hljs-string">&quot;logits&quot;</span>],<br>        dynamic_axes=&#123;<br>            <span class="hljs-string">&quot;input&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;logits&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;<br>        &#125;,<br>        opset_version=<span class="hljs-number">11</span>,<br>        verbose=<span class="hljs-literal">True</span><br>    )<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ONNX exported to:&quot;</span>, onnx_path)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure></details>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®ä»‹ç»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ·±åº¦å­¦ä¹ </tag>
      
      <tag>CNN</tag>
      
      <tag>ONNX</tag>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/11/29/hello-world/"/>
    <url>/2025/11/29/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
